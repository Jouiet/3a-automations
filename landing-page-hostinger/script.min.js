document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("nav-toggle"),t=document.getElementById("nav-menu");e&&t&&(e.addEventListener("click",(()=>{e.classList.toggle("active"),t.classList.toggle("active"),document.body.classList.toggle("nav-open")})),t.querySelectorAll("a").forEach((n=>{n.addEventListener("click",(()=>{e.classList.remove("active"),t.classList.remove("active"),document.body.classList.remove("nav-open")}))})),document.addEventListener("click",(n=>{t.contains(n.target)||e.contains(n.target)||(e.classList.remove("active"),t.classList.remove("active"),document.body.classList.remove("nav-open"))}))),document.querySelectorAll('a[href^="#"]').forEach((e=>{e.addEventListener("click",(function(e){e.preventDefault();const t=document.querySelector(this.getAttribute("href"));if(t){const e=document.querySelector(".header").offsetHeight,n=t.getBoundingClientRect().top+window.pageYOffset-e;window.scrollTo({top:n,behavior:"smooth"})}}))}));const n=document.querySelector(".header");let o=0;window.addEventListener("scroll",(()=>{const e=window.pageYOffset;e>100?(n.style.background="rgba(25, 30, 53, 0.98)",n.style.boxShadow="0 4px 30px rgba(79, 186, 241, 0.1)"):(n.style.background="rgba(25, 30, 53, 0.9)",n.style.boxShadow="none"),o=e}));const a=document.getElementById("audit-form"),s=document.getElementById("form-success"),r=document.getElementById("form-error"),c="https://script.google.com/macros/s/AKfycbyzIHwTDfQpm57LBloFJ53BMkSvsSDd3zCXE41mMSFPMa1m6xOuji3ICKQJA1oiHb-4/exec",i="contact@3a-automation.com",l=5e3;if(a){const e=document.getElementById("form-timestamp");e&&(e.value=(new Date).toISOString()),a.addEventListener("submit",(async function(e){e.preventDefault();const t=a.querySelector('button[type="submit"]'),n=t.querySelector(".btn-text"),o=n?n.textContent:t.textContent;s&&(s.style.display="none"),r&&(r.style.display="none"),n?n.textContent="Envoi en cours...":t.textContent="Envoi en cours...",t.disabled=!0,t.style.opacity="0.7";const d=new FormData(a),m=Object.fromEntries(d.entries());m.timestamp=(new Date).toISOString(),m.userAgent=navigator.userAgent,m.referrer=document.referrer||"direct",m.page=window.location.href;let u=!1;try{const e=new AbortController,t=setTimeout((()=>e.abort()),l),n=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m),signal:e.signal});clearTimeout(t),n.ok&&(u=!0)}catch(e){console.log("Webhook unavailable, using mailto fallback")}if(!u){const e=encodeURIComponent(`[3A Automation] ${m.subject||"Demande"} - ${m.name}`),t=encodeURIComponent(`Nom: ${m.name||"Non spécifié"}\nEmail: ${m.email||"Non spécifié"}\nEntreprise: ${m.company||"Non spécifié"}\nSite web: ${m.website||"Non spécifié"}\nSujet: ${m.subject||"Non spécifié"}\nPlateforme: ${m.platform||"Non spécifié"}\nPays: ${m.country||"Non spécifié"}\n\n--- Message ---\n${m.message||m.challenges||"Pas de message"}\n\n--- Métadonnées ---\nSource: ${m.source||"website"}\nPage: ${m.page}\nDate: ${m.timestamp}`);window.location.href=`mailto:${i}?subject=${e}&body=${t}`,u=!0}u?(a.style.display="none",s&&(s.style.display="flex",s.classList.add("animated")),"function"==typeof gtag&&gtag("event","generate_lead",{event_category:"engagement",event_label:m.subject||m.service||"audit-request",value:1}),a.reset()):r&&(r.style.display="flex",r.classList.add("animated")),n?n.textContent=o:t.textContent=o,t.disabled=!1,t.style.opacity="1"}))}const d=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting&&(e.target.style.opacity="1",e.target.style.transform="translateY(0)",d.unobserve(e.target))}))}),{threshold:.1,rootMargin:"0px 0px -50px 0px"});[".service-card-ultra",".flywheel-stage",".process-step-ultra",".tech-item",".feature-card",".flow-card"].forEach((e=>{document.querySelectorAll(e).forEach(((e,t)=>{e.style.opacity="0",e.style.transform="translateY(20px)",e.style.transition=`opacity 0.5s ease ${.08*t}s, transform 0.5s ease ${.08*t}s`,d.observe(e)}))}));const m=new IntersectionObserver((e=>{e.forEach((e=>{if(e.isIntersecting){const t=parseInt(e.target.dataset.count);t&&((e,t)=>{const n=performance.now(),o=a=>{const s=a-n,r=Math.min(s/2e3,1),c=1-Math.pow(1-r,4),i=Math.floor(0+(t-0)*c);e.textContent=i+(e.dataset.suffix||""),r<1?requestAnimationFrame(o):e.textContent=t+(e.dataset.suffix||"")};requestAnimationFrame(o)})(e.target,t),m.unobserve(e.target)}}))}),{threshold:.5});document.querySelectorAll(".stat-number-ultra[data-count]").forEach((e=>{m.observe(e)}));const u=document.querySelectorAll(".flywheel-stage"),y=document.querySelector(".flywheel-center-hub");u.forEach((e=>{e.addEventListener("mouseenter",(()=>{u.forEach((t=>{t!==e&&(t.style.opacity="0.5")})),y&&(y.style.transform="translate(-50%, -50%) scale(1.1)")})),e.addEventListener("mouseleave",(()=>{u.forEach((e=>{e.style.opacity="1"})),y&&(y.style.transform="translate(-50%, -50%) scale(1)")}))}));document.querySelectorAll(".orbital-ring").forEach((e=>{e.addEventListener("mouseenter",(()=>{e.style.animationPlayState="paused"})),e.addEventListener("mouseleave",(()=>{e.style.animationPlayState="running"}))}));const p=document.querySelectorAll(".cyber-glow");p.length>0&&window.addEventListener("scroll",(()=>{const e=window.pageYOffset;p.forEach(((t,n)=>{const o=.1+.05*n;t.style.transform=`translateY(${e*o}px)`}))}),{passive:!0});document.querySelectorAll(".form-field input, .form-field textarea").forEach((e=>{e.addEventListener("focus",(()=>{e.parentElement.classList.add("focused")})),e.addEventListener("blur",(()=>{e.value||e.parentElement.classList.remove("focused")}))}));const f=document.createElement("div");let g;f.className="cursor-glow",f.style.cssText="\n    position: fixed;\n    width: 300px;\n    height: 300px;\n    background: radial-gradient(circle, rgba(79, 186, 241, 0.05) 0%, transparent 70%);\n    border-radius: 50%;\n    pointer-events: none;\n    z-index: 0;\n    transform: translate(-50%, -50%);\n    transition: opacity 0.3s ease;\n    opacity: 0;\n  ",document.body.appendChild(f),document.addEventListener("mousemove",(e=>{f.style.left=e.clientX+"px",f.style.top=e.clientY+"px",f.style.opacity="1",clearTimeout(g),g=setTimeout((()=>{f.style.opacity="0"}),1e3)})),"ontouchstart"in window&&(f.style.display="none");const v=document.getElementById("cookie-consent"),h=document.getElementById("cookie-accept"),b=document.getElementById("cookie-reject"),E="3a_cookie_consent",x=localStorage.getItem(E);function w(e){localStorage.setItem(E,e),v&&(v.style.animation="slideUp 0.3s ease reverse forwards",setTimeout((()=>{v.style.display="none"}),300))}function L(){"function"==typeof gtag&&gtag("consent","update",{analytics_storage:"granted",ad_storage:"granted"}),window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"cookie_consent_granted",consent_type:"all"})}!x&&v?setTimeout((()=>{v.style.display="block"}),1e3):"accepted"===x&&L(),h&&h.addEventListener("click",(()=>{w("accepted"),L()})),b&&b.addEventListener("click",(()=>{w("rejected"),"function"==typeof gtag&&gtag("consent","update",{analytics_storage:"denied",ad_storage:"denied"}),window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"cookie_consent_rejected",consent_type:"none"})}));document.querySelectorAll(".btn-cyber").forEach((e=>{e.addEventListener("mousemove",(t=>{const n=e.getBoundingClientRect(),o=(t.clientX-n.left)/n.width*100,a=(t.clientY-n.top)/n.height*100;e.style.setProperty("--mouse-x",`${o}%`),e.style.setProperty("--mouse-y",`${a}%`)}))}));document.querySelectorAll(".service-card-ultra, .flow-card, .feature-card").forEach((e=>{e.addEventListener("mousemove",(t=>{const n=e.getBoundingClientRect(),o=t.clientX-n.left,a=t.clientY-n.top,s=n.width/2,r=(a-n.height/2)/20,c=(s-o)/20;e.style.transform=`perspective(1000px) rotateX(${r}deg) rotateY(${c}deg) translateZ(10px)`})),e.addEventListener("mouseleave",(()=>{e.style.transform="perspective(1000px) rotateX(0) rotateY(0) translateZ(0)",e.style.transition="transform 0.5s ease"})),e.addEventListener("mouseenter",(()=>{e.style.transition="none"}))}));const S=new IntersectionObserver((e=>{e.forEach((e=>{if(e.isIntersecting){const t=e.target,n=parseInt(t.dataset.count),o=t.dataset.suffix||"",a=t.textContent.includes("+");if(n){let e=0;const s=n/(2500/16),r=()=>{e+=s,e>=n?t.textContent=n+(a?"+":"")+o:(t.textContent=Math.floor(e)+o,requestAnimationFrame(r))};r()}S.unobserve(t)}}))}),{threshold:.5});document.querySelectorAll("[data-count]").forEach((e=>{S.observe(e)}));document.querySelectorAll(".btn-primary-cyber").forEach((e=>{e.addEventListener("mousemove",(t=>{const n=e.getBoundingClientRect(),o=t.clientX-n.left-n.width/2,a=t.clientY-n.top-n.height/2;e.style.transform=`translate(${.3*o}px, ${.3*a}px)`})),e.addEventListener("mouseleave",(()=>{e.style.transform="translate(0, 0)"}))}));const I=(e,t)=>{const n=document.createElement("div");n.style.cssText=`\n      position: fixed;\n      width: 4px;\n      height: 4px;\n      background: var(--primary);\n      border-radius: 50%;\n      pointer-events: none;\n      z-index: 9999;\n      left: ${e}px;\n      top: ${t}px;\n      box-shadow: 0 0 10px var(--primary);\n    `,document.body.appendChild(n);const o=Math.random()*Math.PI*2,a=50*Math.random()+30,s=Math.cos(o)*a,r=Math.sin(o)*a;let c=1,i=e,l=t;const d=()=>{i+=.016*s,l+=.016*r,c-=.02,n.style.left=i+"px",n.style.top=l+"px",n.style.opacity=c,c>0?requestAnimationFrame(d):n.remove()};requestAnimationFrame(d)};document.addEventListener("click",(e=>{for(let t=0;t<8;t++)setTimeout((()=>I(e.clientX,e.clientY)),30*t)}));const A=document.querySelectorAll("section"),q=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting&&e.target.classList.add("section-visible")}))}),{threshold:.05,rootMargin:"100px 0px -50px 0px"});A.forEach(((e,t)=>{0!==t?(e.classList.add("section-hidden"),q.observe(e)):e.classList.add("section-visible")})),setTimeout((()=>{A.forEach((e=>{e.classList.contains("section-visible")||e.classList.add("section-visible")}))}),3e3);const $=document.createElement("style");$.textContent="\n    .section-hidden {\n      opacity: 0;\n      transform: translateY(40px);\n      transition: opacity 0.8s ease, transform 0.8s ease;\n    }\n    .section-visible {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  ",document.head.appendChild($),(()=>{const e=document.querySelectorAll("[data-animate]"),t=document.querySelectorAll("[data-animate-stagger]"),n=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting&&(e.target.classList.add("animated"),n.unobserve(e.target))}))}),{threshold:.1,rootMargin:"0px 0px -50px 0px"});e.forEach((e=>n.observe(e))),t.forEach((e=>n.observe(e)))})(),console.log("3A Automation - Ultra Futuristic Site v3.1 Initialized")}));